@model IEnumerable<_5032Project_v2.Models.AppointmentViewModel>

@{
    ViewBag.Title = "SendEmail";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<h2>SendEmail</h2>

@if (User.IsInRole("Admin"))
{
    <button id="sendEmailBtn">Send Emails</button>
}

<table class="table">
    <thead>
        <tr>
            <th>Select</th>  <!-- Header for the checkboxes -->
            <th>User Name</th>
            <th>@Html.DisplayNameFor(model => model.DateTime)</th>
            <th>@Html.DisplayNameFor(model => model.Status)</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>
                    <!-- Checkbox for each appointment. Data attribute will store the ID -->
                    <input type="checkbox" class="appointmentCheckbox" data-appointment-id="@item.AppointmentId" />
                </td>
                <td>
                    @item.FirstName @item.LastName
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.DateTime)
                </td>
                <td>
                    @if (item.Status == 0)
                    {
                        @:Waiting for approval
                    }
                    else if (item.Status == 1)
                    {
                        @:Approved
                    }
                    else if (item.Status == 2)
                    {
                        @:Waiting for the imaging
                    }
                    else if (item.Status == 3)
                    {
                        @:Jobs has been done
                    }
                    else
                    {
                        @:Rejected
                    }
                </td>
            </tr>
        }
    </tbody>
</table>

@section Scripts {
    @Scripts.Render("~/Scripts/DataTables/jquery.dataTables.js")
    @Scripts.Render("~/Scripts/DataTables/dataTables.bootstrap.js")

    <script>
        $(document).ready(function () {
            $('.table').DataTable();

            $('#sendEmailBtn').click(function () {
                var selectedAppointments = [];
                $('.appointmentCheckbox:checked').each(function () {
                    selectedAppointments.push($(this).data('appointment-id'));
                });

                if (selectedAppointments.length == 0) {
                    alert("Please select at least one appointment.");
                    return;
                }

                $.post('@Url.Action("SendEmails", "Appointments")', { appointmentIds: selectedAppointments }, function (data) {
                    if (data.success) {
                        alert(data.message);
                    } else {
                        alert("Error: " + data.message);
                    }
                });
            });
        });
    </script>
}

<link href="~/Content/DataTables/css/dataTables.bootstrap.min.css" rel="stylesheet" />
